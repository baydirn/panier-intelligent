// Generate enriched public/prices.initial.json from curated STORE_MAPPING
// CommonJS script to avoid ESM interop issues with edge files
const fs = require('fs')
const path = require('path')

// Minimal duplication of the curated dataset used by the edge function
const STORE_MAPPING = {
  IGA: {
    keywords: ['iga', 'sobeys'],
    products: [
      { name: 'lait 2% 2l', price: 4.99, format: '2L' },
      { name: 'lait 3.25% 4l', price: 8.99, format: '4L' },
      { name: 'lait écrémé 1l', price: 2.79, format: '1L' },
      { name: 'oeufs gros calibre', price: 4.29, format: '12 unités' },
      { name: 'oeufs blancs extra-gros', price: 4.99, format: '12 unités' },
      { name: 'beurre salé', price: 5.99, format: '454g' },
      { name: 'beurre non salé', price: 5.99, format: '454g' },
      { name: 'yogourt nature', price: 3.99, format: '750g' },
      { name: 'yogourt grec vanille', price: 4.99, format: '750g' },
      { name: 'crème 15%', price: 3.49, format: '473ml' },
      { name: 'crème 35%', price: 4.49, format: '473ml' },
      { name: 'fromage cheddar fort', price: 7.99, format: '400g' },
      { name: 'fromage mozzarella râpé', price: 6.99, format: '320g' },
      { name: 'fromage brie', price: 8.99, format: '300g' },
      { name: 'pain tranché blanc', price: 2.49, format: '675g' },
      { name: 'pain multigrains', price: 3.49, format: '675g' },
      { name: 'bagels nature', price: 3.99, format: '6 unités' },
      { name: 'croissants', price: 4.99, format: '6 unités' },
      { name: 'poulet poitrine', price: 12.99, format: 'kg' },
      { name: 'poulet cuisses', price: 7.99, format: 'kg' },
      { name: 'poulet entier', price: 5.99, format: 'kg' },
      { name: 'boeuf haché mi-maigre', price: 8.99, format: 'kg' },
      { name: 'boeuf haché maigre', price: 10.99, format: 'kg' },
      { name: 'porc côtelettes', price: 9.99, format: 'kg' },
      { name: 'porc rôti épaule', price: 7.99, format: 'kg' },
      { name: 'saumon atlantique', price: 14.99, format: 'kg' },
      { name: 'tilapia filets', price: 12.99, format: 'kg' },
      { name: 'crevettes décortiquées', price: 18.99, format: '454g' },
      { name: 'pommes gala', price: 3.99, format: 'kg' },
      { name: 'pommes honeycrisp', price: 5.99, format: 'kg' },
      { name: 'bananes', price: 1.49, format: 'kg' },
      { name: 'oranges', price: 3.49, format: '2 lb' },
      { name: 'fraises', price: 4.99, format: '454g' },
      { name: 'bleuets', price: 5.99, format: '340g' },
      { name: 'raisins rouges', price: 4.99, format: 'kg' },
      { name: 'mangues', price: 2.49, format: 'unité' },
      { name: 'carottes', price: 2.99, format: '2 lb' },
      { name: 'brocoli', price: 3.49, format: 'unité' },
      { name: 'laitue romaine', price: 2.49, format: 'unité' },
      { name: 'laitue iceberg', price: 2.29, format: 'unité' },
      { name: 'tomates cerises', price: 3.99, format: '454g' },
      { name: 'tomates en grappe', price: 4.99, format: 'kg' },
      { name: 'concombres anglais', price: 2.49, format: 'unité' },
      { name: 'poivrons rouges', price: 5.99, format: 'kg' },
      { name: 'oignons jaunes', price: 1.99, format: '3 lb' },
      { name: 'pommes de terre', price: 4.99, format: '5 lb' },
      { name: 'pâtes penne', price: 2.49, format: '500g' },
      { name: 'riz basmati', price: 9.99, format: '5kg' },
      { name: 'farine tout usage', price: 5.99, format: '2.5kg' },
      { name: 'sucre blanc', price: 3.99, format: '2kg' },
      { name: "huile d'olive", price: 12.99, format: '1L' },
      { name: 'sauce tomate', price: 2.99, format: '680ml' },
      { name: 'céréales corn flakes', price: 5.49, format: '525g' },
      { name: 'confiture fraises', price: 4.49, format: '500ml' },
      { name: "jus d'orange tropicana", price: 4.49, format: '1.75L' },
      { name: 'jus de pomme', price: 3.49, format: '1.89L' },
      { name: 'eau embouteillée', price: 3.99, format: '12x500ml' },
      { name: 'café moulu', price: 11.99, format: '925g' },
      { name: 'thé vert', price: 5.99, format: '20 sachets' },
      { name: 'papier toilette 12 rouleaux', price: 9.99, format: '12 unités' },
      { name: 'essuie-tout 6 rouleaux', price: 11.99, format: '6 unités' },
      { name: 'détergent à lessive', price: 12.99, format: '2.95L' },
      { name: 'savon à vaisselle', price: 3.99, format: '740ml' }
    ]
  },
  Walmart: {
    keywords: ['walmart'],
    products: [
      { name: 'lait 2% 2l', price: 4.47, format: '2L' },
      { name: 'lait 3.25% 4l', price: 8.47, format: '4L' },
      { name: 'lait écrémé 1l', price: 2.47, format: '1L' },
      { name: 'oeufs gros calibre', price: 3.97, format: '12 unités' },
      { name: 'oeufs blancs extra-gros', price: 4.47, format: '12 unités' },
      { name: 'beurre salé', price: 5.47, format: '454g' },
      { name: 'beurre non salé', price: 5.47, format: '454g' },
      { name: 'yogourt nature', price: 3.47, format: '750g' },
      { name: 'yogourt grec vanille', price: 4.47, format: '750g' },
      { name: 'crème 15%', price: 3.17, format: '473ml' },
      { name: 'crème 35%', price: 4.17, format: '473ml' },
      { name: 'fromage cheddar fort', price: 7.47, format: '400g' },
      { name: 'fromage mozzarella râpé', price: 6.47, format: '320g' },
      { name: 'pain tranché blanc', price: 1.97, format: '675g' },
      { name: 'pain multigrains', price: 2.97, format: '675g' },
      { name: 'bagels nature', price: 3.47, format: '6 unités' },
      { name: 'tortillas', price: 3.97, format: '10 unités' },
      { name: 'poulet poitrine', price: 11.97, format: 'kg' },
      { name: 'poulet cuisses', price: 7.47, format: 'kg' },
      { name: 'poulet entier', price: 5.47, format: 'kg' },
      { name: 'boeuf haché mi-maigre', price: 7.97, format: 'kg' },
      { name: 'boeuf haché maigre', price: 9.97, format: 'kg' },
      { name: 'porc côtelettes', price: 8.97, format: 'kg' },
      { name: 'saucisses italiennes', price: 6.97, format: '500g' },
      { name: 'tilapia filets', price: 11.97, format: 'kg' },
      { name: 'pommes gala', price: 3.47, format: 'kg' },
      { name: 'pommes red delicious', price: 3.27, format: 'kg' },
      { name: 'bananes', price: 1.27, format: 'kg' },
      { name: 'oranges', price: 2.97, format: '2 lb' },
      { name: 'fraises', price: 4.47, format: '454g' },
      { name: 'raisins verts', price: 4.47, format: 'kg' },
      { name: "melon d'eau", price: 4.97, format: 'unité' },
      { name: 'carottes', price: 2.47, format: '2 lb' },
      { name: 'brocoli', price: 2.97, format: 'unité' },
      { name: 'laitue romaine', price: 1.97, format: 'unité' },
      { name: 'laitue iceberg', price: 1.77, format: 'unité' },
      { name: 'tomates cerises', price: 3.47, format: '454g' },
      { name: 'concombres', price: 1.97, format: 'unité' },
      { name: 'poivrons verts', price: 3.97, format: 'kg' },
      { name: 'oignons jaunes', price: 1.47, format: '3 lb' },
      { name: 'pommes de terre', price: 4.47, format: '5 lb' },
      { name: 'pâtes barilla', price: 1.97, format: '500g' },
      { name: 'céréales cheerios', price: 4.97, format: '430g' },
      { name: 'céréales special k', price: 5.47, format: '400g' },
      { name: 'riz basmati', price: 8.97, format: '5kg' },
      { name: 'farine tout usage', price: 4.97, format: '2.5kg' },
      { name: 'sucre blanc', price: 3.47, format: '2kg' },
      { name: 'huile végétale', price: 6.97, format: '1L' },
      { name: 'sauce tomate', price: 2.47, format: '680ml' },
      { name: "beurre d'arachide", price: 5.97, format: '1kg' },
      { name: 'confiture fraises', price: 3.97, format: '500ml' },
      { name: "jus d'orange", price: 3.97, format: '1.75L' },
      { name: 'jus de pomme', price: 2.97, format: '1.89L' },
      { name: 'eau embouteillée', price: 2.97, format: '24x500ml' },
      { name: 'café moulu', price: 9.97, format: '925g' },
      { name: 'thé noir', price: 4.97, format: '20 sachets' },
      { name: 'cola', price: 4.97, format: '2L' },
      { name: 'papier toilette 12 rouleaux', price: 7.97, format: '12 unités' },
      { name: 'essuie-tout 6 rouleaux', price: 9.97, format: '6 unités' },
      { name: 'détergent à lessive', price: 11.97, format: '2.95L' },
      { name: 'savon à vaisselle', price: 2.97, format: '740ml' },
      { name: 'nettoyant multi-surfaces', price: 4.97, format: '1L' }
    ]
  },
  Costco: {
    keywords: ['costco'],
    products: [
      { name: 'lait 2% 4l', price: 7.99, format: '4L' },
      { name: 'lait 3.25% 4l', price: 7.99, format: '4L' },
      { name: 'oeufs gros calibre', price: 7.49, format: '2x12 unités' },
      { name: 'beurre salé', price: 10.99, format: '4x454g' },
      { name: 'yogourt grec', price: 8.99, format: '2x750g' },
      { name: 'fromage cheddar fort', price: 14.99, format: '900g' },
      { name: 'fromage mozzarella', price: 12.99, format: '900g' },
      { name: 'pain bagels', price: 4.99, format: '6 unités' },
      { name: 'pain hot dog', price: 5.99, format: '12 unités' },
      { name: 'tortillas', price: 6.99, format: '20 unités' },
      { name: 'muffins', price: 7.99, format: '12 unités' },
      { name: 'poulet poitrine', price: 10.99, format: 'kg' },
      { name: 'poulet cuisses', price: 6.99, format: 'kg' },
      { name: 'boeuf haché mi-maigre', price: 6.99, format: 'kg' },
      { name: 'porc côtelettes', price: 8.49, format: 'kg' },
      { name: 'saumon atlantique', price: 12.99, format: 'kg' },
      { name: 'crevettes', price: 24.99, format: '1kg' },
      { name: 'bacon', price: 16.99, format: '1kg' },
      { name: 'pommes gala', price: 7.99, format: '3kg' },
      { name: 'bananes biologiques', price: 2.99, format: '2 lb' },
      { name: 'oranges', price: 8.99, format: '5 lb' },
      { name: 'fraises', price: 8.99, format: '2 lb' },
      { name: 'bleuets', price: 9.99, format: '1 lb' },
      { name: 'raisins', price: 9.99, format: '2 lb' },
      { name: 'carottes', price: 4.99, format: '5 lb' },
      { name: 'brocoli', price: 6.99, format: '4 têtes' },
      { name: 'laitue romaine', price: 5.99, format: '3 unités' },
      { name: 'tomates', price: 7.99, format: '2 lb' },
      { name: 'poivrons', price: 8.99, format: '6 unités' },
      { name: 'oignons', price: 5.99, format: '5 lb' },
      { name: 'pommes de terre', price: 7.99, format: '10 lb' },
      { name: 'pâtes', price: 8.99, format: '2kg' },
      { name: 'riz basmati', price: 16.99, format: '10kg' },
      { name: 'farine', price: 12.99, format: '10kg' },
      { name: 'sucre', price: 9.99, format: '4kg' },
      { name: "huile d'olive extra vierge", price: 16.99, format: '3L' },
      { name: 'sauce tomate', price: 9.99, format: '6x680ml' },
      { name: 'céréales cheerios', price: 12.99, format: '2x1kg' },
      { name: "beurre d'arachide", price: 11.99, format: '2kg' },
      { name: 'confiture', price: 8.99, format: '2x500ml' },
      { name: "jus d'orange", price: 9.99, format: '2.5L' },
      { name: 'eau embouteillée', price: 3.99, format: '35x500ml' },
      { name: 'café grains kirkland', price: 19.99, format: '907g' },
      { name: 'thé vert', price: 12.99, format: '100 sachets' },
      { name: 'cola', price: 12.99, format: '12x355ml' },
      { name: 'papier toilette 30 rouleaux', price: 24.99, format: '30 unités' },
      { name: 'essuie-tout 12 rouleaux', price: 19.99, format: '12 unités' },
      { name: 'détergent à lessive kirkland', price: 24.99, format: '5.73L' },
      { name: 'savon à vaisselle', price: 12.99, format: '3x740ml' },
      { name: 'sacs poubelle', price: 18.99, format: '200 unités' },
      { name: 'pizza surgelée', price: 12.99, format: '3 unités' },
      { name: 'poulet rôti', price: 7.99, format: 'unité' },
      { name: 'lasagne', price: 14.99, format: '1.5kg' }
    ]
  },
  "Super C": {
    keywords: ['super c', 'super-c'],
    products: [
      { name: 'lait 2% 2l', price: 4.29, format: '2L' },
      { name: 'lait 3.25% 4l', price: 7.99, format: '4L' },
      { name: 'lait écrémé 1l', price: 2.29, format: '1L' },
      { name: 'oeufs gros calibre', price: 3.79, format: '12 unités' },
      { name: 'beurre salé', price: 5.29, format: '454g' },
      { name: 'yogourt nature', price: 3.29, format: '750g' },
      { name: 'yogourt grec', price: 3.99, format: '750g' },
      { name: 'crème 15%', price: 2.99, format: '473ml' },
      { name: 'fromage cheddar', price: 5.99, format: '400g' },
      { name: 'fromage mozzarella', price: 5.49, format: '320g' },
      { name: 'pain tranché blanc', price: 1.99, format: '675g' },
      { name: 'pain multigrains', price: 2.79, format: '675g' },
      { name: 'bagels', price: 2.99, format: '6 unités' },
      { name: 'tortillas', price: 3.49, format: '10 unités' },
      { name: 'poulet poitrine', price: 11.49, format: 'kg' },
      { name: 'poulet cuisses', price: 6.99, format: 'kg' },
      { name: 'poulet entier', price: 4.99, format: 'kg' },
      { name: 'boeuf haché mi-maigre', price: 7.49, format: 'kg' },
      { name: 'porc côtelettes', price: 8.49, format: 'kg' },
      { name: 'saucisses', price: 4.99, format: '500g' },
      { name: 'jambon tranché', price: 6.99, format: '500g' },
      { name: 'tilapia', price: 10.99, format: 'kg' },
      { name: 'pommes gala', price: 2.99, format: 'kg' },
      { name: 'pommes mcintosh', price: 2.79, format: 'kg' },
      { name: 'bananes', price: 1.19, format: 'kg' },
      { name: 'oranges', price: 2.79, format: '2 lb' },
      { name: 'fraises', price: 3.99, format: '454g' },
      { name: 'raisins', price: 3.99, format: 'kg' },
      { name: 'cantaloup', price: 2.99, format: 'unité' },
      { name: 'carottes', price: 2.29, format: '2 lb' },
      { name: 'brocoli', price: 2.49, format: 'unité' },
      { name: 'laitue iceberg', price: 1.79, format: 'unité' },
      { name: 'tomates', price: 3.49, format: 'kg' },
      { name: 'concombres', price: 0.99, format: 'unité' },
      { name: 'poivrons verts', price: 1.99, format: 'lb' },
      { name: 'poivrons rouges', price: 3.99, format: 'lb' },
      { name: 'oignons', price: 1.29, format: '3 lb' },
      { name: 'pommes de terre', price: 3.99, format: '5 lb' },
      { name: 'céleri', price: 2.49, format: 'unité' },
      { name: 'pâtes', price: 1.79, format: '500g' },
      { name: 'riz', price: 7.99, format: '5kg' },
      { name: 'farine', price: 4.49, format: '2.5kg' },
      { name: 'sucre', price: 3.29, format: '2kg' },
      { name: 'huile végétale', price: 5.99, format: '1L' },
      { name: 'sauce tomate', price: 1.99, format: '680ml' },
      { name: 'céréales', price: 4.49, format: '500g' },
      { name: "beurre d'arachide", price: 4.99, format: '1kg' },
      { name: 'jus de pomme', price: 2.99, format: '1.89L' },
      { name: "jus d'orange", price: 3.49, format: '1.75L' },
      { name: 'eau embouteillée', price: 2.49, format: '12x500ml' },
      { name: 'café moulu', price: 8.99, format: '925g' },
      { name: 'cola', price: 3.99, format: '2L' },
      { name: 'papier toilette 12 rouleaux', price: 7.49, format: '12 unités' },
      { name: 'essuie-tout', price: 8.99, format: '6 rouleaux' },
      { name: 'détergent à lessive', price: 8.99, format: '2.95L' },
      { name: 'savon à vaisselle', price: 2.79, format: '740ml' },
      { name: 'sacs poubelle', price: 5.99, format: '40 unités' },
      { name: 'chips', price: 2.99, format: '200g' },
      { name: 'biscuits', price: 2.49, format: '300g' }
    ]
  },
  Metro: {
    keywords: ['metro'],
    products: [
      { name: 'lait 2% 2l', price: 4.99, format: '2L' },
      { name: 'pain tranché multigrains', price: 2.79, format: '675g' },
      { name: 'oeufs gros calibre', price: 4.49, format: '12 unités' },
      { name: 'beurre salé', price: 5.99, format: '454g' },
      { name: 'yogourt grec', price: 4.49, format: '750g' },
      { name: 'poulet poitrine', price: 12.99, format: 'kg' },
      { name: 'boeuf haché mi-maigre', price: 8.99, format: 'kg' },
      { name: 'saumon atlantique', price: 15.99, format: 'kg' },
      { name: 'pommes gala', price: 3.99, format: 'kg' },
      { name: 'bananes biologiques', price: 1.99, format: 'kg' },
      { name: 'laitue boston', price: 2.99, format: 'unité' },
      { name: 'tomates italiennes', price: 4.99, format: 'kg' },
      { name: 'fromage brie', price: 8.99, format: '300g' },
      { name: 'croissants', price: 4.99, format: '6 unités' },
      { name: 'vin rouge', price: 12.99, format: '750ml' },
      { name: 'lait 3.25% 4l', price: 9.49, format: '4L' },
      { name: 'lait biologique 2l', price: 6.99, format: '2L' },
      { name: 'oeufs oméga-3', price: 5.99, format: '12 unités' },
      { name: 'beurre non salé', price: 6.49, format: '454g' },
      { name: 'yogourt nature biologique', price: 5.49, format: '650g' },
      { name: 'crème 35%', price: 3.99, format: '473ml' },
      { name: 'pain artisan', price: 4.49, format: '500g' },
      { name: 'croissants', price: 4.99, format: '4 unités' },
      { name: 'baguette', price: 2.99, format: 'unité' },
      { name: 'poulet de grain poitrine', price: 15.99, format: 'kg' },
      { name: 'poulet de grain cuisses', price: 9.99, format: 'kg' },
      { name: 'poulet biologique', price: 19.99, format: 'kg' },
      { name: 'boeuf striploin', price: 24.99, format: 'kg' },
      { name: 'porc côtelettes', price: 11.99, format: 'kg' },
      { name: 'saumon atlantique', price: 16.99, format: 'kg' },
      { name: 'crevettes', price: 19.99, format: 'kg' },
      { name: 'jambon forêt noire', price: 8.99, format: '500g' },
      { name: 'prosciutto', price: 12.99, format: '200g' },
      { name: 'pommes biologiques', price: 5.49, format: 'kg' },
      { name: 'oranges sanguines', price: 3.99, format: 'kg' },
      { name: 'fraises du québec', price: 5.99, format: '454g' },
      { name: 'bleuets', price: 5.49, format: '454g' },
      { name: 'mangue', price: 2.99, format: 'unité' },
      { name: 'avocat', price: 1.99, format: 'unité' },
      { name: 'asperges', price: 4.99, format: 'lb' },
      { name: 'brocoli', price: 2.99, format: 'unité' },
      { name: 'laitue romaine', price: 2.49, format: 'unité' },
      { name: 'salade mesclun', price: 4.99, format: '142g' },
      { name: 'tomates italiennes', price: 4.99, format: 'kg' },
      { name: 'concombres anglais', price: 1.99, format: 'unité' },
      { name: 'poivrons rouges', price: 4.99, format: 'lb' },
      { name: 'champignons portobello', price: 5.99, format: '227g' },
      { name: 'pommes de terre grelots', price: 4.99, format: '680g' },
      { name: 'courge butternut', price: 2.99, format: 'kg' },
      { name: 'pâtes italiennes', price: 3.49, format: '500g' },
      { name: 'riz basmati', price: 6.99, format: '2kg' },
      { name: 'quinoa', price: 9.99, format: '1kg' },
      { name: "huile d'olive extra vierge", price: 12.99, format: '750ml' },
      { name: 'sauce tomate italienne', price: 3.99, format: '680ml' },
      { name: 'céréales granola', price: 5.99, format: '500g' },
      { name: 'jus de canneberge', price: 4.49, format: '1.89L' },
      { name: 'café en grains', price: 12.99, format: '907g' },
      { name: 'thé vert', price: 5.49, format: '20 sachets' },
      { name: 'papier toilette écologique', price: 11.99, format: '12 unités' },
      { name: 'essuie-tout', price: 10.99, format: '6 rouleaux' },
      { name: 'détergent écologique', price: 11.99, format: '2L' },
      { name: 'savon à vaisselle bio', price: 4.49, format: '740ml' },
      { name: 'craquelins', price: 3.99, format: '250g' },
      { name: 'chocolat noir', price: 4.99, format: '100g' },
      { name: 'crème glacée premium', price: 6.99, format: '1L' }
    ]
  }
}

function buildItems(limitPerStore = 200){
  const today = new Date().toISOString().split('T')[0]
  const items = []
  for(const [store, cfg] of Object.entries(STORE_MAPPING)){
    const list = (cfg.products || []).slice(0, limitPerStore)
    for(const p of list){
      items.push({
        name: String(p.name).toLowerCase(),
        store,
        price: Number(p.price),
        format: p.format || null,
        updatedAt: today,
        _source: 'curated-qc-prices'
      })
    }
  }
  return items
}

function main(){
  const outFile = path.join(__dirname, '..', 'public', 'prices.initial.json')
  const items = buildItems(200)
  const payload = {
    version: 2,
    generatedAt: new Date().toISOString(),
    items
  }
  fs.writeFileSync(outFile, JSON.stringify(payload, null, 2), 'utf8')
  console.log(`Wrote ${items.length} items to ${outFile}`)
}

if (require.main === module){
  main()
}
